{"content":"<p>本章介绍如何对 Shell 脚本除错。</p>\n<!-- more -->\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>编写 Shell 脚本的时候，一定要考虑到命令失败的情况，否则很容易出错。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">/path/not/exist</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，如果目录 <code v-pre>$dir_name</code> 不存在，<code v-pre>cd $dir_name</code> 命令就会执行失败。这时，就不会改变当前目录，脚本会继续执行下去，导致 <code v-pre>rm *</code> 命令删光当前目录的文件。</p>\n<p>如果改成下面的样子，也会有问题。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，只有 <code v-pre>cd $dir_name</code> 执行成功，才会执行 <code v-pre>rm *</code>。但是，如果变量 <code v-pre>$dir_name</code> 为空，<code v-pre>cd</code> 就会进入用户主目录，从而删光用户主目录的文件。</p>\n<p>下面的写法才是正确的。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面代码中，先判断目录 <code v-pre>$dir_name</code> 是否存在，然后才执行其他操作。</p>\n<p>如果不放心删除什么文件，可以先打印出来看一下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面命令中，<code v-pre>echo rm *</code> 不会删除文件，只会打印出来要删除的文件。</p>\n<h2 id=\"bash-的-x-参数\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-的-x-参数\"><span><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数</span></a></h2>\n<p><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数可以在执行每一行命令之前，打印该命令。这样就不用自己输出执行的命令，一旦出错，比较容易追查。</p>\n<p>下面是一个脚本 <code v-pre>script.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>加上 <code v-pre>-x</code> 参数，执行每条命令之前，都会显示该命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> bash</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> -x</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>上面例子中，行首为 <code v-pre>+</code> 的行，显示该行是所要执行的命令，下一行才是该命令的执行结果。</p>\n<p>下面再看一个 <code v-pre>-x</code> 写在脚本内部的例子。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash -x</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># trouble: script to demonstrate common errors</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">if</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> [ </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]; </span><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">then</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">else</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is not equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">fi</span></span></code></pre>\n</div><p>上面的脚本执行之后，会输出每一行命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>输出的命令之前的 <code v-pre>+</code> 号，是由系统变量 <code v-pre>PS4</code> 决定，可以修改这个变量。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> export</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> PS4='$LINENO + '</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">5</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">7</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">8</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>另外，<code v-pre>set</code> 命令也可以设置 Shell 的行为参数，有利于脚本除错，详见 <RouteLink to=\"/linux/bash/set.html\">set 命令</RouteLink> 一章。</p>\n<h2 id=\"环境变量\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#环境变量\"><span>环境变量</span></a></h2>\n<p>有一些环境变量常用于除错。</p>\n<h3 id=\"lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#lineno\"><span>LINENO</span></a></h3>\n<p>变量 <code v-pre>LINENO</code> 返回它在脚本里面的行号。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"This is line </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span></code></pre>\n</div><p>执行上面的脚本 <code v-pre>test.sh</code>，<code v-pre>$LINENO</code> 会返回 <code v-pre>3</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">This</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> line</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 3</span></span></code></pre>\n</div><h3 id=\"funcname\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#funcname\"><span>FUNCNAME</span></a></h3>\n<p>变量 <code v-pre>FUNCNAME</code> 返回一个数组，内容是当前的函数调用堆栈。该数组的 0 号成员是当前调用的函数，1 号成员是调用当前函数的函数，以此类推。</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>执行上面的脚本 <code v-pre>test.sh</code>，结果如下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span></code></pre>\n</div><p>上面例子中，执行 <code v-pre>func1</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func1</code>，1 号成员是调用 <code v-pre>func1</code> 的主脚本 <code v-pre>main</code>。执行 <code v-pre>func2</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func2</code>，1 号成员是调用 <code v-pre>func2</code> 的 <code v-pre>func1</code>。</p>\n<h3 id=\"bash-source\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-source\"><span>BASH_SOURCE</span></a></h3>\n<p>变量 <code v-pre>BASH_SOURCE</code> 返回一个数组，内容是当前的脚本调用堆栈。该数组的 0 号成员是当前执行的脚本，1 号成员是调用当前脚本的脚本，以此类推，跟变量 <code v-pre>FUNCNAME</code> 是一一对应关系。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span></code></pre>\n</div><p>上面例子中，执行函数 <code v-pre>func1</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func1</code> 所在的脚本 <code v-pre>lib1.sh</code>，1 号成员是主脚本 <code v-pre>main.sh</code>；执行函数 <code v-pre>func2</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func2</code> 所在的脚本 <code v-pre>lib2.sh</code>，1 号成员是调用 <code v-pre>func2</code> 的脚本 <code v-pre>lib1.sh</code>。</p>\n<h3 id=\"bash-lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-lineno\"><span>BASH_LINENO</span></a></h3>\n<p>变量 <code v-pre>BASH_LINENO</code> 返回一个数组，内容是每一轮调用对应的行号。<code v-pre>${BASH_LINENO[$i]}</code> 跟 <code v-pre>${FUNCNAME[$i]}</code> 是一一对应关系，表示 <code v-pre>${FUNCNAME[$i]}</code> 在调用它的脚本文件 <code v-pre>${BASH_SOURCE[$i+1]}</code> 里面的行号。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span></code></pre>\n</div><p>上面例子中，函数 <code v-pre>func1</code> 是在 <code v-pre>main.sh</code> 的第 7 行调用，函数 <code v-pre>func2</code> 是在 <code v-pre>lib1.sh</code> 的第 8 行调用的。</p>\n","env":{"base":"/","filePath":"/Users/carson/Desktop/Mister-Hope.github.io-main/src/linux/bash/debug.md","filePathRelative":"linux/bash/debug.md","frontmatter":{"date":"2020-05-04T00:00:00.000Z","title":"脚本除错","icon":"debug","author":"阮一峰","category":"Linux","tag":["Bash"],"copyright":"本教程采用<a href=\"https://creativecommons.org/licenses/by-sa/3.0/deed.zh\" rel=\"noopener noreferrer\" target=\"_blank\">知识共享 署名-相同方式共享 3.0协议</a>"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>本章介绍如何对 Shell 脚本除错。</p>\n<!-- more -->\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>编写 Shell 脚本的时候，一定要考虑到命令失败的情况，否则很容易出错。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">/path/not/exist</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，如果目录 <code v-pre>$dir_name</code> 不存在，<code v-pre>cd $dir_name</code> 命令就会执行失败。这时，就不会改变当前目录，脚本会继续执行下去，导致 <code v-pre>rm *</code> 命令删光当前目录的文件。</p>\n<p>如果改成下面的样子，也会有问题。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，只有 <code v-pre>cd $dir_name</code> 执行成功，才会执行 <code v-pre>rm *</code>。但是，如果变量 <code v-pre>$dir_name</code> 为空，<code v-pre>cd</code> 就会进入用户主目录，从而删光用户主目录的文件。</p>\n<p>下面的写法才是正确的。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面代码中，先判断目录 <code v-pre>$dir_name</code> 是否存在，然后才执行其他操作。</p>\n<p>如果不放心删除什么文件，可以先打印出来看一下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面命令中，<code v-pre>echo rm *</code> 不会删除文件，只会打印出来要删除的文件。</p>\n<h2 id=\"bash-的-x-参数\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-的-x-参数\"><span><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数</span></a></h2>\n<p><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数可以在执行每一行命令之前，打印该命令。这样就不用自己输出执行的命令，一旦出错，比较容易追查。</p>\n<p>下面是一个脚本 <code v-pre>script.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>加上 <code v-pre>-x</code> 参数，执行每条命令之前，都会显示该命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> bash</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> -x</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>上面例子中，行首为 <code v-pre>+</code> 的行，显示该行是所要执行的命令，下一行才是该命令的执行结果。</p>\n<p>下面再看一个 <code v-pre>-x</code> 写在脚本内部的例子。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash -x</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># trouble: script to demonstrate common errors</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">if</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> [ </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]; </span><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">then</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">else</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is not equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">fi</span></span></code></pre>\n</div><p>上面的脚本执行之后，会输出每一行命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>输出的命令之前的 <code v-pre>+</code> 号，是由系统变量 <code v-pre>PS4</code> 决定，可以修改这个变量。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> export</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> PS4='$LINENO + '</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">5</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">7</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">8</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>另外，<code v-pre>set</code> 命令也可以设置 Shell 的行为参数，有利于脚本除错，详见 <RouteLink to=\"/linux/bash/set.html\">set 命令</RouteLink> 一章。</p>\n<h2 id=\"环境变量\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#环境变量\"><span>环境变量</span></a></h2>\n<p>有一些环境变量常用于除错。</p>\n<h3 id=\"lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#lineno\"><span>LINENO</span></a></h3>\n<p>变量 <code v-pre>LINENO</code> 返回它在脚本里面的行号。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"This is line </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span></code></pre>\n</div><p>执行上面的脚本 <code v-pre>test.sh</code>，<code v-pre>$LINENO</code> 会返回 <code v-pre>3</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">This</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> line</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 3</span></span></code></pre>\n</div><h3 id=\"funcname\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#funcname\"><span>FUNCNAME</span></a></h3>\n<p>变量 <code v-pre>FUNCNAME</code> 返回一个数组，内容是当前的函数调用堆栈。该数组的 0 号成员是当前调用的函数，1 号成员是调用当前函数的函数，以此类推。</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>执行上面的脚本 <code v-pre>test.sh</code>，结果如下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span></code></pre>\n</div><p>上面例子中，执行 <code v-pre>func1</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func1</code>，1 号成员是调用 <code v-pre>func1</code> 的主脚本 <code v-pre>main</code>。执行 <code v-pre>func2</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func2</code>，1 号成员是调用 <code v-pre>func2</code> 的 <code v-pre>func1</code>。</p>\n<h3 id=\"bash-source\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-source\"><span>BASH_SOURCE</span></a></h3>\n<p>变量 <code v-pre>BASH_SOURCE</code> 返回一个数组，内容是当前的脚本调用堆栈。该数组的 0 号成员是当前执行的脚本，1 号成员是调用当前脚本的脚本，以此类推，跟变量 <code v-pre>FUNCNAME</code> 是一一对应关系。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span></code></pre>\n</div><p>上面例子中，执行函数 <code v-pre>func1</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func1</code> 所在的脚本 <code v-pre>lib1.sh</code>，1 号成员是主脚本 <code v-pre>main.sh</code>；执行函数 <code v-pre>func2</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func2</code> 所在的脚本 <code v-pre>lib2.sh</code>，1 号成员是调用 <code v-pre>func2</code> 的脚本 <code v-pre>lib1.sh</code>。</p>\n<h3 id=\"bash-lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-lineno\"><span>BASH_LINENO</span></a></h3>\n<p>变量 <code v-pre>BASH_LINENO</code> 返回一个数组，内容是每一轮调用对应的行号。<code v-pre>${BASH_LINENO[$i]}</code> 跟 <code v-pre>${FUNCNAME[$i]}</code> 是一一对应关系，表示 <code v-pre>${FUNCNAME[$i]}</code> 在调用它的脚本文件 <code v-pre>${BASH_SOURCE[$i+1]}</code> 里面的行号。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span></code></pre>\n</div><p>上面例子中，函数 <code v-pre>func1</code> 是在 <code v-pre>main.sh</code> 的第 7 行调用，函数 <code v-pre>func2</code> 是在 <code v-pre>lib1.sh</code> 的第 8 行调用的。</p>\n</template>","contentStripped":"<p>本章介绍如何对 Shell 脚本除错。</p>\n<!-- more -->\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>编写 Shell 脚本的时候，一定要考虑到命令失败的情况，否则很容易出错。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">/path/not/exist</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，如果目录 <code v-pre>$dir_name</code> 不存在，<code v-pre>cd $dir_name</code> 命令就会执行失败。这时，就不会改变当前目录，脚本会继续执行下去，导致 <code v-pre>rm *</code> 命令删光当前目录的文件。</p>\n<p>如果改成下面的样子，也会有问题。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面脚本中，只有 <code v-pre>cd $dir_name</code> 执行成功，才会执行 <code v-pre>rm *</code>。但是，如果变量 <code v-pre>$dir_name</code> 为空，<code v-pre>cd</code> 就会进入用户主目录，从而删光用户主目录的文件。</p>\n<p>下面的写法才是正确的。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面代码中，先判断目录 <code v-pre>$dir_name</code> 是否存在，然后才执行其他操作。</p>\n<p>如果不放心删除什么文件，可以先打印出来看一下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">[[ </span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">-d</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]] &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">cd</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\"> $dir_name</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> &#x26;&#x26; </span><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> rm</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E5C07B\"> *</span></span></code></pre>\n</div><p>上面命令中，<code v-pre>echo rm *</code> 不会删除文件，只会打印出来要删除的文件。</p>\n<h2 id=\"bash-的-x-参数\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-的-x-参数\"><span><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数</span></a></h2>\n<p><code v-pre>bash</code> 的 <code v-pre>-x</code> 参数可以在执行每一行命令之前，打印该命令。这样就不用自己输出执行的命令，一旦出错，比较容易追查。</p>\n<p>下面是一个脚本 <code v-pre>script.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>加上 <code v-pre>-x</code> 参数，执行每条命令之前，都会显示该命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> bash</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> -x</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> script.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">hello</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> world</span></span></code></pre>\n</div><p>上面例子中，行首为 <code v-pre>+</code> 的行，显示该行是所要执行的命令，下一行才是该命令的执行结果。</p>\n<p>下面再看一个 <code v-pre>-x</code> 写在脚本内部的例子。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#! /bin/bash -x</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># trouble: script to demonstrate common errors</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\">=</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">if</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> [ </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$number</span><span style=\"--shiki-light:#383A42;--shiki-dark:#56B6C2\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\"> ]; </span><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">then</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">else</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"Number is not equal to 1.\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">fi</span></span></code></pre>\n</div><p>上面的脚本执行之后，会输出每一行命令。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">+</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>输出的命令之前的 <code v-pre>+</code> 号，是由系统变量 <code v-pre>PS4</code> 决定，可以修改这个变量。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> export</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> PS4='$LINENO + '</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> trouble</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">5</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> number=</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\">1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">7</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> '['</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> =</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ']'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">8</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> +</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 'Number is equal to 1.'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">Number</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> equal</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> to</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> 1.</span></span></code></pre>\n</div><p>另外，<code v-pre>set</code> 命令也可以设置 Shell 的行为参数，有利于脚本除错，详见 <RouteLink to=\"/linux/bash/set.html\">set 命令</RouteLink> 一章。</p>\n<h2 id=\"环境变量\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#环境变量\"><span>环境变量</span></a></h2>\n<p>有一些环境变量常用于除错。</p>\n<h3 id=\"lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#lineno\"><span>LINENO</span></a></h3>\n<p>变量 <code v-pre>LINENO</code> 返回它在脚本里面的行号。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"This is line </span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">$LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span></code></pre>\n</div><p>执行上面的脚本 <code v-pre>test.sh</code>，<code v-pre>$LINENO</code> 会返回 <code v-pre>3</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">This</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> line</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 3</span></span></code></pre>\n</div><h3 id=\"funcname\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#funcname\"><span>FUNCNAME</span></a></h3>\n<p>变量 <code v-pre>FUNCNAME</code> 返回一个数组，内容是当前的函数调用堆栈。该数组的 0 号成员是当前调用的函数，1 号成员是调用当前函数的函数，以此类推。</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>执行上面的脚本 <code v-pre>test.sh</code>，结果如下。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./test.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main</span></span></code></pre>\n</div><p>上面例子中，执行 <code v-pre>func1</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func1</code>，1 号成员是调用 <code v-pre>func1</code> 的主脚本 <code v-pre>main</code>。执行 <code v-pre>func2</code> 时，变量 <code v-pre>FUNCNAME</code> 的 0 号成员是 <code v-pre>func2</code>，1 号成员是调用 <code v-pre>func2</code> 的 <code v-pre>func1</code>。</p>\n<h3 id=\"bash-source\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-source\"><span>BASH_SOURCE</span></a></h3>\n<p>变量 <code v-pre>BASH_SOURCE</code> 返回一个数组，内容是当前的脚本调用堆栈。该数组的 0 号成员是当前执行的脚本，1 号成员是调用当前脚本的脚本，以此类推，跟变量 <code v-pre>FUNCNAME</code> 是一一对应关系。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE0 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE1 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE2 is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[2]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE0</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE1</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE2</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span></code></pre>\n</div><p>上面例子中，执行函数 <code v-pre>func1</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func1</code> 所在的脚本 <code v-pre>lib1.sh</code>，1 号成员是主脚本 <code v-pre>main.sh</code>；执行函数 <code v-pre>func2</code> 时，变量 <code v-pre>BASH_SOURCE</code> 的 0 号成员是 <code v-pre>func2</code> 所在的脚本 <code v-pre>lib2.sh</code>，1 号成员是调用 <code v-pre>func2</code> 的脚本 <code v-pre>lib1.sh</code>。</p>\n<h3 id=\"bash-lineno\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#bash-lineno\"><span>BASH_LINENO</span></a></h3>\n<p>变量 <code v-pre>BASH_LINENO</code> 返回一个数组，内容是每一轮调用对应的行号。<code v-pre>${BASH_LINENO[$i]}</code> 跟 <code v-pre>${FUNCNAME[$i]}</code> 是一一对应关系，表示 <code v-pre>${FUNCNAME[$i]}</code> 在调用它的脚本文件 <code v-pre>${BASH_SOURCE[$i+1]}</code> 里面的行号。</p>\n<p>下面有两个子脚本 <code v-pre>lib1.sh</code> 和 <code v-pre>lib2.sh</code>。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func1</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func1: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">  func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># lib2.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A626A4;--shiki-dark:#C678DD\">function</span><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\"> func2</span><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_LINENO is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: FUNCNAME is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[0]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">  echo</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> \"func2: BASH_SOURCE is </span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">${</span><span style=\"--shiki-light:#E45649;--shiki-dark:#E06C75\">BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">[1]</span><span style=\"--shiki-light:#E45649;--shiki-dark:#98C379\">}</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\">}</span></span></code></pre>\n</div><p>然后，主脚本 <code v-pre>main.sh</code> 调用上面两个子脚本。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic\"># main.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#0184BC;--shiki-dark:#56B6C2\">source</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib2.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1</span></span></code></pre>\n</div><p>执行主脚本 <code v-pre>main.sh</code>，会得到下面的结果。</p>\n<div class=\"language-bash\" data-highlighter=\"shiki\" data-ext=\"bash\" data-title=\"bash\" style=\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\"><pre v-pre class=\"shiki shiki-themes one-light one-dark-pro vp-code\"><code><span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">$</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> ./main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func1:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> main.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_LINENO</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#986801;--shiki-dark:#D19A66\"> 8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> FUNCNAME</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> func2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\">func2:</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> BASH_SOURCE</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> is</span><span style=\"--shiki-light:#50A14F;--shiki-dark:#98C379\"> lib1.sh</span></span></code></pre>\n</div><p>上面例子中，函数 <code v-pre>func1</code> 是在 <code v-pre>main.sh</code> 的第 7 行调用，函数 <code v-pre>func2</code> 是在 <code v-pre>lib1.sh</code> 的第 8 行调用的。</p>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n本章介绍如何对 Shell 脚本除错。\n\n<!-- more -->\n\n## 常见错误\n\n编写 Shell 脚本的时候，一定要考虑到命令失败的情况，否则很容易出错。\n\n```bash\n#! /bin/bash\n\ndir_name=/path/not/exist\n\ncd $dir_name\nrm *\n```\n\n上面脚本中，如果目录 `$dir_name` 不存在，`cd $dir_name` 命令就会执行失败。这时，就不会改变当前目录，脚本会继续执行下去，导致 `rm *` 命令删光当前目录的文件。\n\n如果改成下面的样子，也会有问题。\n\n```bash\ncd $dir_name && rm *\n```\n\n上面脚本中，只有 `cd $dir_name` 执行成功，才会执行 `rm *`。但是，如果变量 `$dir_name` 为空，`cd` 就会进入用户主目录，从而删光用户主目录的文件。\n\n下面的写法才是正确的。\n\n```bash\n[[ -d $dir_name ]] && cd $dir_name && rm *\n```\n\n上面代码中，先判断目录 `$dir_name` 是否存在，然后才执行其他操作。\n\n如果不放心删除什么文件，可以先打印出来看一下。\n\n```bash\n[[ -d $dir_name ]] && cd $dir_name && echo rm *\n```\n\n上面命令中，`echo rm *` 不会删除文件，只会打印出来要删除的文件。\n\n## `bash` 的 `-x` 参数\n\n`bash` 的 `-x` 参数可以在执行每一行命令之前，打印该命令。这样就不用自己输出执行的命令，一旦出错，比较容易追查。\n\n下面是一个脚本 `script.sh`。\n\n```bash\n# script.sh\necho hello world\n```\n\n加上 `-x` 参数，执行每条命令之前，都会显示该命令。\n\n```bash\n$ bash -x script.sh\n+ echo hello world\nhello world\n```\n\n上面例子中，行首为 `+` 的行，显示该行是所要执行的命令，下一行才是该命令的执行结果。\n\n下面再看一个 `-x` 写在脚本内部的例子。\n\n```bash\n#! /bin/bash -x\n# trouble: script to demonstrate common errors\n\nnumber=1\nif [ $number = 1 ]; then\n  echo \"Number is equal to 1.\"\nelse\n  echo \"Number is not equal to 1.\"\nfi\n```\n\n上面的脚本执行之后，会输出每一行命令。\n\n```bash\n$ trouble\n+ number=1\n+ '[' 1 = 1 ']'\n+ echo 'Number is equal to 1.'\nNumber is equal to 1.\n```\n\n输出的命令之前的 `+` 号，是由系统变量 `PS4` 决定，可以修改这个变量。\n\n```bash\n$ export PS4='$LINENO + '\n$ trouble\n5 + number=1\n7 + '[' 1 = 1 ']'\n8 + echo 'Number is equal to 1.'\nNumber is equal to 1.\n```\n\n另外，`set` 命令也可以设置 Shell 的行为参数，有利于脚本除错，详见 [set 命令](set.md) 一章。\n\n## 环境变量\n\n有一些环境变量常用于除错。\n\n### LINENO\n\n变量 `LINENO` 返回它在脚本里面的行号。\n\n```bash\n#!/bin/bash\n\necho \"This is line $LINENO\"\n```\n\n执行上面的脚本 `test.sh`，`$LINENO` 会返回 `3`。\n\n```bash\n$ ./test.sh\nThis is line 3\n```\n\n### FUNCNAME\n\n变量 `FUNCNAME` 返回一个数组，内容是当前的函数调用堆栈。该数组的 0 号成员是当前调用的函数，1 号成员是调用当前函数的函数，以此类推。\n\n```bash\n#!/bin/bash\n\nfunction func1()\n{\n  echo \"func1: FUNCNAME0 is ${FUNCNAME[0]}\"\n  echo \"func1: FUNCNAME1 is ${FUNCNAME[1]}\"\n  echo \"func1: FUNCNAME2 is ${FUNCNAME[2]}\"\n  func2\n}\n\nfunction func2()\n{\n  echo \"func2: FUNCNAME0 is ${FUNCNAME[0]}\"\n  echo \"func2: FUNCNAME1 is ${FUNCNAME[1]}\"\n  echo \"func2: FUNCNAME2 is ${FUNCNAME[2]}\"\n}\n\nfunc1\n```\n\n执行上面的脚本 `test.sh`，结果如下。\n\n```bash\n$ ./test.sh\nfunc1: FUNCNAME0 is func1\nfunc1: FUNCNAME1 is main\nfunc1: FUNCNAME2 is\nfunc2: FUNCNAME0 is func2\nfunc2: FUNCNAME1 is func1\nfunc2: FUNCNAME2 is main\n```\n\n上面例子中，执行 `func1` 时，变量 `FUNCNAME` 的 0 号成员是 `func1`，1 号成员是调用 `func1` 的主脚本 `main`。执行 `func2` 时，变量 `FUNCNAME` 的 0 号成员是 `func2`，1 号成员是调用 `func2` 的 `func1`。\n\n### BASH_SOURCE\n\n变量 `BASH_SOURCE` 返回一个数组，内容是当前的脚本调用堆栈。该数组的 0 号成员是当前执行的脚本，1 号成员是调用当前脚本的脚本，以此类推，跟变量 `FUNCNAME` 是一一对应关系。\n\n下面有两个子脚本 `lib1.sh` 和 `lib2.sh`。\n\n```bash\n# lib1.sh\nfunction func1()\n{\n  echo \"func1: BASH_SOURCE0 is ${BASH_SOURCE[0]}\"\n  echo \"func1: BASH_SOURCE1 is ${BASH_SOURCE[1]}\"\n  echo \"func1: BASH_SOURCE2 is ${BASH_SOURCE[2]}\"\n  func2\n}\n```\n\n```bash\n# lib2.sh\nfunction func2()\n{\n  echo \"func2: BASH_SOURCE0 is ${BASH_SOURCE[0]}\"\n  echo \"func2: BASH_SOURCE1 is ${BASH_SOURCE[1]}\"\n  echo \"func2: BASH_SOURCE2 is ${BASH_SOURCE[2]}\"\n}\n```\n\n然后，主脚本 `main.sh` 调用上面两个子脚本。\n\n```bash\n#!/bin/bash\n# main.sh\n\nsource lib1.sh\nsource lib2.sh\n\nfunc1\n```\n\n执行主脚本 `main.sh`，会得到下面的结果。\n\n```bash\n$ ./main.sh\nfunc1: BASH_SOURCE0 is lib1.sh\nfunc1: BASH_SOURCE1 is ./main.sh\nfunc1: BASH_SOURCE2 is\nfunc2: BASH_SOURCE0 is lib2.sh\nfunc2: BASH_SOURCE1 is lib1.sh\nfunc2: BASH_SOURCE2 is ./main.sh\n```\n\n上面例子中，执行函数 `func1` 时，变量 `BASH_SOURCE` 的 0 号成员是 `func1` 所在的脚本 `lib1.sh`，1 号成员是主脚本 `main.sh`；执行函数 `func2` 时，变量 `BASH_SOURCE` 的 0 号成员是 `func2` 所在的脚本 `lib2.sh`，1 号成员是调用 `func2` 的脚本 `lib1.sh`。\n\n### BASH_LINENO\n\n变量 `BASH_LINENO` 返回一个数组，内容是每一轮调用对应的行号。`${BASH_LINENO[$i]}` 跟 `${FUNCNAME[$i]}` 是一一对应关系，表示 `${FUNCNAME[$i]}` 在调用它的脚本文件 `${BASH_SOURCE[$i+1]}` 里面的行号。\n\n下面有两个子脚本 `lib1.sh` 和 `lib2.sh`。\n\n```bash\n# lib1.sh\nfunction func1()\n{\n  echo \"func1: BASH_LINENO is ${BASH_LINENO[0]}\"\n  echo \"func1: FUNCNAME is ${FUNCNAME[0]}\"\n  echo \"func1: BASH_SOURCE is ${BASH_SOURCE[1]}\"\n\n  func2\n}\n```\n\n```bash\n# lib2.sh\nfunction func2()\n{\n  echo \"func2: BASH_LINENO is ${BASH_LINENO[0]}\"\n  echo \"func2: FUNCNAME is ${FUNCNAME[0]}\"\n  echo \"func2: BASH_SOURCE is ${BASH_SOURCE[1]}\"\n}\n```\n\n然后，主脚本 `main.sh` 调用上面两个子脚本。\n\n```bash\n#!/bin/bash\n# main.sh\n\nsource lib1.sh\nsource lib2.sh\n\nfunc1\n```\n\n执行主脚本 `main.sh`，会得到下面的结果。\n\n```bash\n$ ./main.sh\nfunc1: BASH_LINENO is 7\nfunc1: FUNCNAME is func1\nfunc1: BASH_SOURCE is main.sh\nfunc2: BASH_LINENO is 8\nfunc2: FUNCNAME is func2\nfunc2: BASH_SOURCE is lib1.sh\n```\n\n上面例子中，函数 `func1` 是在 `main.sh` 的第 7 行调用，函数 `func2` 是在 `lib1.sh` 的第 8 行调用的。\n","excerpt":"","title":"","headers":[{"level":2,"title":"常见错误","slug":"常见错误","link":"#常见错误","children":[]},{"level":2,"title":"bash 的 -x 参数","slug":"bash-的-x-参数","link":"#bash-的-x-参数","children":[]},{"level":2,"title":"环境变量","slug":"环境变量","link":"#环境变量","children":[{"level":3,"title":"LINENO","slug":"lineno","link":"#lineno","children":[]},{"level":3,"title":"FUNCNAME","slug":"funcname","link":"#funcname","children":[]},{"level":3,"title":"BASH_SOURCE","slug":"bash-source","link":"#bash-source","children":[]},{"level":3,"title":"BASH_LINENO","slug":"bash-lineno","link":"#bash-lineno","children":[]}]}],"links":[{"raw":"set.md","relative":"linux/bash/set.md","absolute":"/linux/bash/set.md"}]}}
