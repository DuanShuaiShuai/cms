{"version":3,"file":"index.js","sources":["../../src/client/helpers/revealJs.ts","../../src/client/components/RevealJs.ts"],"sourcesContent":["// eslint-disable-next-line import/no-rename-default\nimport type Reveal from 'reveal.js'\nimport type { App } from 'vue'\nimport { inject } from 'vue'\n\ndeclare const __VUEPRESS_DEV__: boolean\n\nexport type RevealJsOptions = Omit<Reveal.Options, 'embedded'>\n\nlet revealOptions: Partial<RevealJsOptions> = {}\n\nconst revealJsSymbol = Symbol(__VUEPRESS_DEV__ ? 'revealjs' : '')\n\nexport const defineRevealJsConfig = (\n  options: Partial<RevealJsOptions>,\n): void => {\n  revealOptions = options\n}\n\nexport const useRevealJsConfig = (): Partial<RevealJsOptions> =>\n  inject(revealJsSymbol)!\n\nexport const injectRevealJsConfig = (app: App): void => {\n  app.provide(revealJsSymbol, revealOptions)\n}\n","import { useRevealJs } from '@temp/revealjs/index.js'\nimport { LoadingIcon, decodeData, wait } from '@vuepress/helper/client'\n// eslint-disable-next-line import/no-rename-default\nimport type Reveal from 'reveal.js/dist/reveal.esm.js'\nimport type { PropType, VNode } from 'vue'\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from 'vue'\nimport { usePageFrontmatter, usePageLayout } from 'vuepress/client'\n\nimport type { RevealJsTheme } from '../../shared/index.js'\nimport { useRevealJsConfig } from '../helpers/index.js'\n\nimport '../styles/reveal-js.css'\n\ndeclare const __REVEAL_DELAY__: number\n\nexport const RevealJs = defineComponent({\n  name: 'RevealJs',\n\n  props: {\n    /**\n     * Presentation id\n     *\n     * 幻灯片 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Presentation code\n     *\n     * 幻灯片代码\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Presentation theme\n     *\n     * 幻灯片主题\n     */\n    theme: { type: String as PropType<RevealJsTheme>, default: 'auto' },\n  },\n\n  setup(props) {\n    const revealOptions = useRevealJsConfig()\n    const frontmatter = usePageFrontmatter<{ revealJs: Reveal.Options }>()\n    const layout = usePageLayout()\n\n    const code = ref('')\n    const loading = ref(true)\n    const presentationContainer = shallowRef<HTMLElement>()\n\n    let reveal: Reveal.Api | null = null\n\n    const initRevealJs = async (\n      container: HTMLElement,\n    ): Promise<Reveal.Api> => {\n      const promises: [Promise<void>, ...ReturnType<typeof useRevealJs>] = [\n        wait(__REVEAL_DELAY__),\n        ...useRevealJs(),\n      ]\n\n      const [, { default: Reveal }, ...plugins] = await Promise.all(promises)\n\n      const isSlidePage = layout.value.name === 'SlidePage'\n\n      const instance = new Reveal(container, {\n        backgroundTransition: 'slide',\n        transition: 'slide',\n        slideNumber: true,\n        ...revealOptions,\n        hash: isSlidePage,\n        mouseWheel: isSlidePage,\n        ...frontmatter.value.revealJs,\n        embedded: !isSlidePage,\n        keyboardCondition: isSlidePage ? null : 'focused',\n        markdown: {\n          separator: '^\\r?\\\\n---\\r?\\n$',\n          verticalSeparator: '^\\r?\\n--\\r?\\n$',\n        },\n\n        plugins: [\n          plugins.map(({ default: plugin }) => plugin),\n\n          revealOptions.plugins ?? [],\n        ].flat(),\n      })\n\n      await instance.initialize()\n\n      return instance\n    }\n\n    onMounted(async () => {\n      const container = presentationContainer.value\n\n      if (container) {\n        code.value = decodeData(props.code)\n\n        container.setAttribute('id', props.id)\n        container.setAttribute('data-theme', props.theme)\n\n        reveal = await initRevealJs(container)\n\n        loading.value = false\n      }\n    })\n\n    onUnmounted(() => {\n      reveal?.destroy()\n    })\n\n    return (): VNode =>\n      h('div', { class: 'vp-reveal' }, [\n        h(\n          'div',\n          {\n            ref: presentationContainer,\n            class: ['reveal', 'reveal-viewport'],\n          },\n          h('div', {\n            class: 'slides',\n            innerHTML: `<section data-markdown><script type=\"text/template\">${code.value}</script></section>`,\n          }),\n        ),\n        loading.value\n          ? h(LoadingIcon, { class: 'reveal-loading', height: 400 })\n          : null,\n      ])\n  },\n})\n"],"names":["revealOptions","revealJsSymbol","defineRevealJsConfig","options","useRevealJsConfig","inject","injectRevealJsConfig","app","RevealJs","defineComponent","props","frontmatter","usePageFrontmatter","layout","usePageLayout","code","ref","loading","presentationContainer","shallowRef","reveal","initRevealJs","container","promises","wait","useRevealJs","Reveal","plugins","isSlidePage","instance","plugin","onMounted","decodeData","onUnmounted","h","LoadingIcon"],"mappings":"+VASA,IAAIA,EAA0C,CAAC,EAE/C,MAAMC,EAAiB,OAAO,iBAAmB,WAAa,EAAE,EAEnDC,EACXC,GACS,CACTH,EAAgBG,CAClB,EAEaC,EAAoB,IAC/BC,EAAOJ,CAAc,EAEVK,EAAwBC,GAAmB,CACtDA,EAAI,QAAQN,EAAgBD,CAAa,CAC3C,ECFaQ,EAAWC,EAAgB,CACtC,KAAM,WAEN,MAAO,CAML,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,KAAM,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOrC,MAAO,CAAE,KAAM,OAAmC,QAAS,MAAO,CACpE,EAEA,MAAMC,EAAO,CACX,MAAMV,EAAgBI,EAAAA,EAChBO,EAAcC,EAAAA,EACdC,EAASC,EAETC,EAAAA,EAAOC,EAAI,EAAE,EACbC,EAAUD,EAAI,EAAI,EAClBE,EAAwBC,EAAwB,EAEtD,IAAIC,EAA4B,KAEhC,MAAMC,EAAe,MACnBC,GACwB,CACxB,MAAMC,EAA+D,CACnEC,EAAK,gBAAgB,EACrB,GAAGC,GACL,EAEM,EAAG,CAAE,QAASC,CAAO,EAAG,GAAGC,CAAO,EAAI,MAAM,QAAQ,IAAIJ,CAAQ,EAEhEK,EAAcf,EAAO,MAAM,OAAS,YAEpCgB,EAAW,IAAIH,EAAOJ,EAAW,CACrC,qBAAsB,QACtB,WAAY,QACZ,YAAa,GACb,GAAGtB,EACH,KAAM4B,EACN,WAAYA,EACZ,GAAGjB,EAAY,MAAM,SACrB,SAAU,CAACiB,EACX,kBAAmBA,EAAc,KAAO,UACxC,SAAU,CACR,UAAW;AAAA,GACX,kBAAmB;AAAA;AAAA,EACrB,EAEA,QAAS,CACPD,EAAQ,IAAI,CAAC,CAAE,QAASG,CAAO,IAAMA,CAAM,EAE3C9B,EAAc,SAAW,CAAA,CAC3B,EAAE,MACJ,CAAC,EAED,OAAA,MAAM6B,EAAS,aAERA,CACT,EAEA,OAAAE,EAAU,SAAY,CACpB,MAAMT,EAAYJ,EAAsB,MAEpCI,IACFP,EAAK,MAAQiB,EAAWtB,EAAM,IAAI,EAElCY,EAAU,aAAa,KAAMZ,EAAM,EAAE,EACrCY,EAAU,aAAa,aAAcZ,EAAM,KAAK,EAEhDU,EAAS,MAAMC,EAAaC,CAAS,EAErCL,EAAQ,MAAQ,GAEpB,CAAC,EAEDgB,EAAY,IAAM,CAChBb,GAAQ,QAAQ,CAClB,CAAC,EAEM,IACLc,EAAE,MAAO,CAAE,MAAO,WAAY,EAAG,CAC/BA,EACE,MACA,CACE,IAAKhB,EACL,MAAO,CAAC,SAAU,iBAAiB,CACrC,EACAgB,EAAE,MAAO,CACP,MAAO,SACP,UAAW,uDAAuDnB,EAAK,KAAK,sBAC9E,CAAC,CACH,EACAE,EAAQ,MACJiB,EAAEC,EAAa,CAAE,MAAO,iBAAkB,OAAQ,GAAI,CAAC,EACvD,IACN,CAAC,CACL,CACF,CAAC"}