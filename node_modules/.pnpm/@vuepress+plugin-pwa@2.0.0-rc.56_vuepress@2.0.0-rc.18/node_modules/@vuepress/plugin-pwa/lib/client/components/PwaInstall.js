import{useLocaleConfig as h}from"@vuepress/helper/client";import{useEventListener as g,useToggle as C}from"@vueuse/core";import{defineComponent as f,shallowRef as b,onMounted as w,h as e,ref as u,computed as y}from"vue";import{withBase as k}from"vuepress/client";import{C as P,A as S,a as A}from"../icons-DQk7h1-3.js";import"../styles/modal.css";const O=f({name:"PwaInstallModal",props:{locales:{type:Object,required:!0},useHint:Boolean},emits:["canInstall","hint","close"],setup(c,{emit:l}){const o=h(c.locales),a=b({}),s=b(),r=async()=>{const t=localStorage.getItem("manifest");if(t)a.value=JSON.parse(t);else try{const m=await(await fetch(k("manifest.webmanifest"))).json();a.value=m,localStorage.setItem("manifest",JSON.stringify(m))}catch{console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}},v=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:-t.clientWidth,top:0,behavior:"smooth"})},p=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:t.clientWidth,top:0,behavior:"smooth"})},i=async()=>{s.value&&(s.value.prompt(),document.dispatchEvent(new CustomEvent("show")),(await s.value.userChoice).outcome==="accepted"?(console.info("PWA has been installed"),l("close",!1),l("canInstall",!1)):(console.info("You choose to not install PWA"),l("close",!1),l("canInstall",!1)))},d=()=>{console.info("You accepted the install hint"),l("hint")};return w(()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(g(window,"beforeinstallprompt",t=>{s.value=t,l("canInstall",!0),t.preventDefault()}),g("keyup",t=>{t.key==="Escape"&&l("close",!1)}),r())}),()=>e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>{l("close",!1)}}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{type:"button",class:"close-button","aria-label":o.value.close,onClick:()=>{l("close",!1)}},e(P)),e("div",{class:"logo"},[a.value.icons?e("img",{src:a.value.icons[0]?.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",a.value.short_name||a.value.name),e("p",{class:"desc"},o.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[a.value.features?e("div",{class:"feature-wrapper"},[e("h3",o.value.feature),e("ul",a.value.features.map(t=>e("li",t)))]):null,a.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{type:"button","aria-label":o.value.prevImage,onClick:v},e(S)),e("section",{class:"screenshot"},[a.value.screenshots.map(t=>e("div",e("img",{src:t.src,alt:"App Screenshot"})))]),e("button",{type:"button","aria-label":o.value.nextImage,onClick:p},e(A))]):null]),e("div",{class:"description"},[e("h3",o.value.desc),e("p",a.value.description)])]),c.useHint?e("div",{class:"ios-text",onClick:d},[e("p",o.value.iOSInstall),e("button",{type:"button",class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{type:"button",class:"install-button",onClick:i},[o.value.install,e("span",a.value.short_name)]),e("button",{type:"button",class:"cancel-button",onClick:()=>{l("close",!1)}},o.value.cancel)])])])}}),x=f({name:"PwaInstall",props:{locales:{type:Object,required:!0}},setup(c){const l=h(c.locales),[o,a]=C(!1),s=u(!1),r=u(!1),v=u(!1),p=u(!1),i=u(!1),d=y(()=>v.value&&p.value&&!i.value),t=y(()=>r.value&&s.value||d.value),m=()=>navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches,I=()=>{a(!1),i.value=!0,localStorage.setItem("iOS-pwa-hint","hinted")};return w(()=>{if(m()){const{userAgent:n}=navigator;v.value=n.includes("iPhone")||n.includes("iPad")||!!(n.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),p.value=navigator.userAgent.includes("Safari")&&!n.includes("Chrome"),i.value=!!localStorage.getItem("iOS-pwa-hint")}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(n=>{r.value=n.length>0})}),()=>e("div",{id:"pwa-install"},[t.value?e("button",{type:"button",class:"modal-button",onClick:()=>{a(!0)}},l.value.install):null,e(O,{style:{display:o.value?"block":"none"},locales:c.locales,useHint:d.value,onCanInstall:n=>{s.value=n},onHint:()=>{I()},onClose:()=>a(!1)})])}});export{x as PwaInstall};
//# sourceMappingURL=PwaInstall.js.map
